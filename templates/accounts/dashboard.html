.{% extends "base.html" %} {% block content %} {% load static %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="{% static 'style.css' %}">
<div class="container mt-4"> <!-- <h3 class="mb-4">ğŸ“Š Welcome, {{ user.get_full_name|default:user.username }}</h3> -->
    <div class="row g-4"> {# ---------------- ADMIN DASHBOARD ---------------- #} {% if user.role == "Admin" %} <h3
            class="mb-4">ğŸ“Š Admin Dashboard</h3> <!-- Admin Stat Cards -->
        <div class="row text-center"> <!-- Students -->
            <div class="col-md-3 mb-3">
                <div class="card text-white shadow-lg p-3 dashboard-card"
                    style="background: linear-gradient(135deg, #4e73df, #224abe);">
                    <div class="card-body d-flex flex-column justify-content-center"> <i
                            class="bi bi-people-fill fs-2 mb-2"></i>
                        <h6 class="fw-bold">Students</h6>
                        <p class="fs-3 mb-0">{{ students_count }}</p>
                    </div>
                </div>
            </div> <!-- Lecturers -->
            <div class="col-md-3 mb-3">
                <div class="card text-white shadow-lg p-3 dashboard-card"
                    style="background: linear-gradient(135deg, #36b9cc, #117a8b);">
                    <div class="card-body d-flex flex-column justify-content-center"> <i
                            class="bi bi-person-workspace fs-2 mb-2"></i>
                        <h6 class="fw-bold">Lecturers</h6>
                        <p class="fs-3 mb-0">{{ lecturers_count }}</p>
                    </div>
                </div>
            </div> <!-- Courses -->
            <div class="col-md-3 mb-3">
                <div class="card text-white shadow-lg p-3 dashboard-card"
                    style="background: linear-gradient(135deg, #f7971e, #ffd200);">
                    <div class="card-body d-flex flex-column justify-content-center"> <i
                            class="bi bi-book fs-2 mb-2"></i>
                        <h6 class="fw-bold">Courses</h6>
                        <p class="fs-3 mb-0">{{ courses_count }}</p>
                    </div>
                </div>
            </div> <!-- Allocations -->
            <div class="col-md-3 mb-3">
                <div class="card text-white shadow-lg p-3 dashboard-card"
                    style="background: linear-gradient(135deg, #1cc88a, #0f9d58);">
                    <div class="card-body d-flex flex-column justify-content-center"> <i
                            class="bi bi-diagram-3 fs-2 mb-2"></i>
                        <h6 class="fw-bold">Allocations</h6>
                        <p class="fs-3 mb-0">{{ enrollments_count }}</p>
                    </div>
                </div>
            </div>
        </div> <!-- Chart + Activity -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card shadow-lg">
                    <div class="card-header bg-light fw-bold">ğŸ“Š Course Allocations</div>
                    <div class="card-body"> <canvas id="allocChart"></canvas> </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card shadow-lg">
                    <div class="card-header bg-light fw-bold">ğŸ“ Recent Activity</div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">+ New student registered</li>
                            <li class="list-group-item">ğŸ“Œ Lecturer assigned to CSC101</li>
                            <li class="list-group-item">ğŸ“š Course added: MTH201</li>
                            <li class="list-group-item">âœ… Allocation updated</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div> {% endif %} {# ---------------- LECTURER DASHBOARD ---------------- #} {% if user.role == "Lecturer" %}
        <h3 class="mb-4">ğŸ‘¨â€ğŸ« Lecturer Dashboard</h3> <!-- Stat Cards -->
        <div class="row text-center"> <!-- Assigned Courses -->
            <div class="col-md-6 mb-3">
                <div class="card text-white shadow-lg p-3 dashboard-card"
                    style="background: linear-gradient(135deg, #4e73df, #224abe);">
                    <div class="card-body d-flex flex-column justify-content-center"> <i
                            class="bi bi-journal-text fs-2 mb-2"></i>
                        <h6 class="fw-bold">Assigned Courses</h6>
                        <p class="fs-3 mb-0">{{ total_courses }}</p>
                    </div>
                </div>
            </div> <!-- Enrolled Students -->
            <div class="col-md-6 mb-3">
                <div class="card text-white shadow-lg p-3 dashboard-card"
                    style="background: linear-gradient(135deg, #1cc88a, #0f9d58);">
                    <div class="card-body d-flex flex-column justify-content-center"> <i
                            class="bi bi-people fs-2 mb-2"></i>
                        <h6 class="fw-bold">Enrolled Students</h6>
                        <p class="fs-3 mb-0">{{ total_students }}</p>
                    </div>
                </div>
            </div>
        </div> <!-- Progress Bars -->
        <h4 class="mt-5 fw-bold">ğŸ“š Course Progress</h4>
        <div class="card shadow-lg p-3"> {% for item in course_progress %} <div class="mb-3"> <strong>{{
                    item.course.code }} - {{ item.course.title }}</strong>
                <div class="progress mt-1" style="height: 20px; border-radius: 10px;">
                    <div class="progress-bar bg-success" role="progressbar"
                        style="width: {{ item.progress }}%; border-radius: 10px;"> {{ item.progress }}% </div>
                </div>
            </div> {% empty %} <p class="text-muted">No courses assigned yet.</p> {% endfor %} </div>
        <!-- Course Table -->
        <h4 class="mt-5">ğŸ•’ My Courses</h4>
        <table class="table table-striped table-bordered mt-3">
            <thead class="table-light">
                <tr>
                    <th>Course Code</th>
                    <th>Title</th>
                    <th>Students Enrolled</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody> {% for course in lecturer_courses %} <tr>
                    <td>{{ course.code }}</td>
                    <td>{{ course.title }}</td>
                    <td>{{ course.enrollments.count }}</td>
                    <td> <!-- Mark Attendance --> <a href="{% url 'mark_attendance' course.id %}"
                            class="btn btn-sm btn-outline-success me-2"> ğŸ“‹ Attendance </a> <!-- Upload Grades --> <a
                            href="{% url 'upload_grades' course.id %}" class="btn btn-sm btn-outline-primary"> ğŸ“ Grades
                        </a> </td>
                </tr> {% empty %} <tr>
                    <td colspan="4" class="text-center text-muted">No courses assigned.</td>
                </tr> {% endfor %} </tbody>
        </table> {% endif %} {# ---------------- STUDENT DASHBOARD ---------------- #} {% if user.role == "Student" %}
        <h3 class="mb-4">ğŸ“ Student Dashboard</h3> <!-- Stat Cards -->
        <div class="row text-center"> <!-- My Courses -->
            <div class="col-md-4 mb-3">
                <div class="card text-white shadow-lg p-3 dashboard-card"
                    style="background: linear-gradient(135deg, #4e73df, #224abe);">
                    <div class="card-body d-flex flex-column justify-content-center"> <i
                            class="bi bi-book fs-2 mb-2"></i>
                        <h6 class="fw-bold">My Courses</h6>
                        <p class="fs-3 mb-0">{{total_courses}}</p>
                    </div>
                </div>
            </div> <!-- Predicted GPA -->
            <div class="col-md-4 mb-3">
                <div class="card text-white shadow-lg p-3 dashboard-card"
                    style="background: linear-gradient(135deg, #1cc88a, #0f9d58);">
                    <div class="card-body d-flex flex-column justify-content-center"> <i
                            class="bi bi-graph-up fs-2 mb-2"></i>
                        <h6 class="fw-bold">Predicted GPA</h6>
                        <p class="fs-3 mb-0">{{gpa}}</p>
                    </div>
                </div>
            </div> <!-- Exam Eligibility -->
            <div class="col-md-4 mb-3">
                <div class="card text-white shadow-lg p-3 dashboard-card"
                    style="background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);">
                    <div class="card-body d-flex flex-column justify-content-center"> <i
                            class="bi bi-check-circle fs-2 mb-2"></i>
                        <h6 class="fw-bold">Exam Eligibility</h6>
                        <p class="fs-3 mb-0">{{eligibility}}</p>
                    </div>
                </div>
            </div>
        </div> <!-- GPA Chart -->
        <div class="card shadow-lg mt-4" style="height: 400px; width: 680px;">
            <div class="card-header bg-light fw-bold">ğŸ“ˆ GPA Trend</div>
            <div class="card-body"> <canvas id="gpaChart"></canvas> </div>
        </div> <!-- Course Table -->
        <h4 class="mt-5">ğŸ•’ My Courses</h4>
        <table class="table table-striped table-bordered mt-3">
            <thead class="table-light">
                <tr>
                    <th>Course Code</th>
                    <th>Title</th>
                    <th>Lecturer</th>
                </tr>
            </thead>
            <tbody> {% for course in courses %} <tr>
                    <td>{{ course.code }}</td>
                    <td>{{ course.title }}</td>
                    <td>{{ course.lecturer.get_full_name }}</td>
                </tr> {% empty %} <tr>
                    <td colspan="3" class="text-center text-muted">No courses yet.</td>
                </tr> {% endfor %} </tbody>
        </table> {% endif %}
    </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Inject user role from Django into JS
    const userRole = "{{ user.role }}";

    if (userRole === "Admin") {
        const ctx1 = document.getElementById('allocChart');
        if (ctx1) {
            new Chart(ctx1, {
                type: 'pie',
                data: {
                    labels: ['Lecturer A', 'Lecturer B', 'Lecturer C'],
                    datasets: [{
                        data: [10, 15, 5],
                        backgroundColor: ['#0d6efd', '#198754', '#ffc107']
                    }]
                }
            });
        }
    }

    if (userRole === "Student") {
        const ctx = document.getElementById('gpaChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ["ND1 First Semester", "ND1 Second Semester", "ND2 First Semester", "ND2 Second Semester"],
                datasets: [{
                    label: "GPA",
                    data: {{ gpa_trend| safe }
        },
            borderColor: "rgba(78, 115, 223, 1)",
            backgroundColor: "rgba(78, 115, 223, 0.2)",
            tension: 0.4,
            fill: true
                }]
            }
        });
    }
</script>

{% endblock %}